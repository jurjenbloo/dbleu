<!doctype html>
<html lang="en">
  <head>
    <!-- Dynamic Title -->
    {{ if .IsHome }}
      <title>{{ .Site.Title }}</title>
    {{ else if eq .Title .Site.Title }}
      <title>{{ .Site.Title }}</title>
    {{ else }}
      <title>{{ .Title }} | {{ .Site.Title }}</title>
    {{ end }}

    <!-- Meta basics -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    {{/* Robust description logic */}}
    {{ $description := .Site.Params.description }}
    {{ if .Description }}
      {{ $description = .Description }}
    {{ end }}
    <meta name="description" content="{{ $description | plainify }}" />

    <!-- SEO helpers -->
    {{ partial "google_analytics.html" . }}
    {{ partial "opengraph.html" . }}
    {{ partial "schema.html" . }}
    {{ partial "twitter_cards.html" . }}

    <!-- Favicons & manifest -->
    {{ range $icon := slice "favicon.ico" "apple-touch-icon.png" "favicon-32x32.png" "favicon-16x16.png" }}
      {{ with resources.Get $icon }}
        <link rel="{{ if eq $icon "favicon.ico" }}icon{{ else if eq $icon "apple-touch-icon.png" }}apple-touch-icon{{ else }}icon{{ end }}" type="image/{{ if in $icon "png" }}png{{ else }}x-icon{{ end }}" sizes="{{ if eq $icon "apple-touch-icon.png" }}180x180{{ else if eq $icon "favicon-32x32.png" }}32x32{{ else if eq $icon "favicon-16x16.png" }}16x16{{ end }}" href="{{ .Permalink }}" />
      {{ end }}
    {{ end }}
    {{ with resources.Get "site.webmanifest" }}<link rel="manifest" href="{{ .Permalink }}" />{{ end }}
    {{ with resources.Get "safari-pinned-tab.svg" }}<link rel="mask-icon" href="{{ .Permalink }}" color="#FFFFFF" />{{ end }}
    <meta name="theme-color" content="#ffffff" />

    <!-- RSS -->
    {{ range .AlternativeOutputFormats }}
      <link rel="{{ .Rel }}" type="{{ .MediaType.Type }}" href="{{ .Permalink }}" title="{{ $.Site.Title }}" />
    {{ end }}

    <!-- Styles -->
    {{ with (templates.Defer (dict "key" "global")) }}
      {{ with resources.Get "css/styles.css" | resources.ExecuteAsTemplate "css/styles.css" $ | css.TailwindCSS (dict "inlineImports" true "optimize" true "minify" true) | fingerprint }}
        <link rel="stylesheet" href="{{ .RelPermalink }}" integrity="{{ .Data.Integrity }}" crossorigin="anonymous" />
      {{ end }}
    {{ end }}

    {{ with resources.Get "css/fonts.css" | resources.ExecuteAsTemplate "css/fonts.css" $ | css.TailwindCSS (dict "inlineImports" true "optimize" true "minify" true) | fingerprint }}
      <link rel="stylesheet" href="{{ .RelPermalink }}" integrity="{{ .Data.Integrity }}" crossorigin="anonymous" />
    {{ end }}

    <!-- Scripts -->
    {{ with resources.Get "js/main.js" | js.Build (dict "minify" true) | fingerprint }}
      <script src="{{ .RelPermalink }}" defer></script>
    {{ end }}
  </head>

  <body class="min-h-screen flex flex-col">
    {{ partial "shared/header" . }}

    <!-- MAIN CONTENT -->
    <main id="main" role="main" tabindex="-1" class="grow">
      {{ block "main" . }}{{ end }}
    </main>

    {{ partial "shared/footer" . }}
  </body>
</html>
